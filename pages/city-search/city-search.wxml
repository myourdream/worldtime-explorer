<!-- pages/city-search/city-search.wxml -->
<view class="container">
  
  <!-- æœç´¢å¤´éƒ¨ -->
  <view class="search-header">
    <view class="search-box">
      <input class="search-input" 
             placeholder="è¾“å…¥åŸå¸‚åç§°æˆ–å›½å®¶åç§°" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearchConfirm"
             focus="{{true}}" />
      <button class="search-btn" bindtap="onSearchConfirm" size="mini">
        <text class="search-icon">ğŸ”</text>
      </button>
    </view>
    <view class="search-tips">
      <text class="tip-text">{{searchTips}}</text>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history" wx:if="{{searchHistory.length > 0 && !searchKeyword}}">
    <view class="history-header">
      <text class="history-title">æœç´¢å†å²</text>
      <button class="clear-history-btn" bindtap="clearHistory" size="mini">æ¸…ç©º</button>
    </view>
    <view class="history-list">
      <view class="history-item" 
            wx:for="{{searchHistory}}" 
            wx:key="index"
            bindtap="selectHistoryItem"
            data-keyword="{{item}}">
        <text class="history-text">{{item}}</text>
        <text class="history-delete" bindtap="deleteHistoryItem" data-index="{{index}}" catchtap="true">âœ•</text>
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨åŸå¸‚ -->
  <view class="popular-cities" wx:if="{{!searchKeyword}}">
    <view class="section-header">
      <text class="section-title">çƒ­é—¨åŸå¸‚</text>
    </view>
    <view class="cities-grid">
      <view class="city-item" 
            wx:for="{{popularCities}}" 
            wx:key="timezone"
            bindtap="selectCity"
            data-city="{{item}}">
        <text class="city-flag">{{item.flag}}</text>
        <text class="city-name">{{item.name}}</text>
        <text class="city-country">{{item.country}}</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{searchKeyword}}">
    <view class="results-header">
      <text class="results-title">æœç´¢ç»“æœ</text>
      <text class="results-count">{{searchResults.length}}ä¸ªç»“æœ</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{isSearching}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨æœç´¢...</text>
    </view>

    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
    <view class="results-list" wx:if="{{!isSearching && searchResults.length > 0}}">
      <city-card 
        wx:for="{{searchResults}}" 
        wx:key="timezone"
        city-data="{{item}}"
        current-time="{{currentTime}}"
        show-remove="{{false}}"
        bind:favoriteChange="onFavoriteChange"
        bind:cityTap="onCityTap">
      </city-card>
    </view>

    <!-- æ— ç»“æœçŠ¶æ€ -->
    <view class="no-results" wx:if="{{!isSearching && searchResults.length === 0}}">
      <text class="no-results-icon">ğŸ”</text>
      <text class="no-results-text">æœªæ‰¾åˆ°ç›¸å…³åŸå¸‚</text>
      <text class="no-results-tip">è¯·å°è¯•å…¶ä»–å…³é”®è¯</text>
    </view>
  </view>

  <!-- æ—¶åŒºåˆ†ç»„ -->
  <view class="timezone-groups" wx:if="{{!searchKeyword}}">
    <view class="section-header">
      <text class="section-title">æŒ‰æ—¶åŒºæµè§ˆ</text>
    </view>
    <view class="groups-list">
      <view class="group-item" 
            wx:for="{{timezoneGroups}}" 
            wx:key="name"
            bindtap="selectTimezoneGroup"
            data-group="{{item}}">
        <view class="group-info">
          <text class="group-name">{{item.name}}</text>
          <text class="group-count">{{item.timezones.length}}ä¸ªåŸå¸‚</text>
        </view>
        <text class="group-arrow">></text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions" wx:if="{{selectedCities.length > 0}}">
    <view class="selected-info">
      <text class="selected-count">å·²é€‰æ‹© {{selectedCities.length}} ä¸ªåŸå¸‚</text>
    </view>
    <button class="add-selected-btn" bindtap="addSelectedCities">æ·»åŠ åˆ°é¦–é¡µ</button>
  </view>
</view>
